
-- p.112 99번 문제
-- 1번
CREATE TABLE PRODUCT
( PROD_ID VARCHAR2(10) NOT NULL,
  PROD_NM VARCHAR2(100) NOT NULL,
  REG_DT DATE NOT NULL,
  REGR_NO NUMBER(10) NULL );    
ALTER TABLE PRODUCT ADD PRIMARY KEY PRODUCT_PK ON (PROD_ID);

-- 2번
CREATE TABLE PRODUCT
( PROD_ID VARCHAR2(10) NOT NULL,
  PROD_NM VARCHAR2(100) NOT NULL,
  REG_DT DATE,
  REGR_NO NUMBER(10) NULL );
ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_PK PRIMARY KEY (PROD_ID);

-- 3번
CREATE TABLE PRODUCT
( PROD_ID VARCHAR2(10) NOT NULL,
  PROD_NM VARCHAR2(100) NOT NULL,
  REG_DT DATE NOT NULL,
  REGR_NO NUMBER(10) NULL,
  ADD CONSTRAINT PRIMARY KEY (PROD_ID) );

-- 4번
CREATE TABLE PRODUCT
( PROD_ID VARCHAR2(10) NOT NULL,
  PROD_NM VARCHAR2(100) NOT NULL,
  REG_DT DATE NOT NULL,
  REGR_NO NUMBER(10),
  CONSTRAINT PRODUCT_PK PRIMARY KEY (PROD_ID));

-- p.117 DML



-- p.122 114번 문제
CREATE TABLE TBL
(
	ID NUMBER PRIMARY KEY,
	AMT NUMBER NOT NULL,
	DEGREE VARCHAR2(1)
)

INSERT INTO TBL VALUES(1, 100);	-- (가)
INSERT INTO TBL(ID, AMT, DEGREE) VALUES (2, 200, 'AB'); -- (나)
INSERT INTO TBL(ID, DEGREE) VALUES (4, 'X'); -- (다)
INSERT INTO TBL(ID, AMT) VALUES (3, 300); -- (라)
INSERT INTO TBL VALUES (5, 500, NULL); -- (마)

DROP TABLE TBL;

-- p.123 115번 문제

CREATE TABLE BOARD
(
	BOARD_ID VARCHAR(10) NOT NULL PRIMARY KEY,
	BOARD_NM VARCHAR(50) NOT NULL,
	USE_YN VARCHAR(1) NOT NULL,
	REG_DATE DATE NOT NULL,
	BOARD_DESC VARCHAR2(100) NULL
);

INSERT INTO BOARD VALUES(1, 'Q&A', 'Y', SYSDATE, 'Q&A게시판'); -- 1번
INSERT INTO BOARD(BOARD_ID, BOARD_NM, USE_YN, BOARD_DESC) VALUES ('100', 'FAQ', 'Y', 'FAQ 게시판'); -- 2번
UPDATE BOARD SET USE_YN='N' WHERE BOARD_ID='1'; -- 3번

INSERT INTO BOARD(BOARD_ID, BOARD_NM, USE_YN, REG_DATE, BOARD_DESC) VALUES ('100', '자유', 'Y', SYSDATE, '자유 게시판');
UPDATE BOARD SET BOARD_ID=200 WHERE BOARD_ID='100'; -- 4번

DROP TABLE BOARD;

SELECT * FROM board;

-- p.123 116번 문제

CREATE TABLE 주문
(
	주문번호 NUMBER NOT NULL PRIMARY KEY,
	주문일자 DATE NOT NULL,
	회원번호 NUMBER NOT NULL,
	주문상태코드 VARCHAR(3) DEFAULT '000'
);

INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (1, SYSDATE, 1900123, '002');
INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (2, '20190301', 1900124, '001');
INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (3, SYSDATE-1, 1900125, '001');
INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (4, 20190301, 1900126, '001');

INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (6, '2019!03!01', 1900124, '001');
INSERT INTO 주문(주문번호, 주문일자, 회원번호, 주문상태코드) VALUES (7, TO_DATE('2019!03!01', 'YYYY!MM!DD'), 1900124, '001');

SELECT * FROM 주문;

DROP TABLE 주문;

-- p.129 126번 문제

-- 1번
UPDATE 부서 A 
SET 담당자=(
    SELECT C.부서코드
    FROM (SELECT 부서코드, MAX(변경일자) AS 변경일자
          FROM 부서임시
          GROUP BY 부서코드) B, 부서임시 C
          WHERE B.부서코드=C.부서코드
          AND B.변경일자=C.변경일자
          AND A.부서코드=C.부서코드)

-- 2번
UPDATE 부서 A 
SET 담당자=(
    SELECT C.부서코드
    FROM (SELECT 부서코드, MAX(변경일자) AS 변경일자
          FROM 부서임시
          GROUP BY 부서코드) B, 부서임시 C
          WHERE B.부서코드=C.부서코드
          AND B.변경일자=C.변경일자
          AND A.부서코드=C.부서코드)
WHERE EXISTS (SELECT 1 FROM 부서 X WHERE A.부서코드=X.부서코드)

-- 3번
UPDATE 부서 A 
SET 담당자=(
    SELECT B.담당자
    FROM   부서임시 B
   	WHERE  B.부서코드=A.부서코드
   	AND    B.변경일자=(
   		   SELECT MAX(C.변경일자)
           FROM 부서임시 C
           WHERE C.부서코드=B.부서코드))
WHERE 부서코드 IN (SELECT 부서코드 FROM 부서임시);

-- 4번
UPDATE 부서 A 
SET 담당자=(
    SELECT B.담당자
    FROM 부서임시 B
    WHERE A.부서코드=B.부서코드
    AND B.변경일자='2015.01.25')

DROP TABLE 부서;
DROP TABLE 부서임시;